{% extends "chat/base.html" %}
{% load static %}

{% block content %}
<h2 class="text-xl mb-2">Hello {{ user.username }}, talk to Jarvis ðŸ’¬</h2>

<!-- Motivational Quote -->
<div style="background:#e6f7ff; padding:10px; border-radius:8px; margin-bottom:10px;">
    ðŸŒŸ <i>"Every day may not be good, but thereâ€™s something good in every day."</i>
</div>

<div id="chat-container" style="
    display: flex;
    flex-direction: column;
    height: 75vh;
    border: 1px solid #ccc;
    border-radius: 8px;
    overflow: hidden;
">
    <!-- Chat messages -->
    <div id="chat-box" style="
        flex: 1;
        overflow-y: auto;
        padding: 10px;
        display: flex;
        flex-direction: column;
    ">
        {% if chats %}
        {% for chat in chats reversed %}
        <div style="margin-bottom:10px; display:flex; 
    {% if chat.is_bot %} justify-content:flex-start; {% else %} justify-content:flex-end; {% endif %}">
            <div style="max-width:60%; padding:10px; border-radius:10px;
        {% if chat.is_bot %}
            background:#f0f0f0; text-align:left;
        {% else %}
            background:#d1e7ff; text-align:right;
        {% endif %}">
                {% if chat.is_bot %}
                <p><b>Jarvis:</b> {{ chat.message }}</p>
                {% else %}
                <p><b>{{ chat.user.username }}:</b> {{ chat.message }}</p>
                {% endif %}
            </div>
        </div>
        {% endfor %}

        {% else %}
        <p>No chats yet. Start a conversation!</p>
        {% endif %}
    </div>

    <!-- Quick Support Buttons -->
    <div style="padding:10px; border-top:1px solid #ccc; background:#fafafa; display:flex; gap:10px; flex-wrap:wrap;">
        <button type="button" onclick="quickMessage('I feel anxious')"
            style="padding:5px 10px; border-radius:6px; background:#ffe6e6;">ðŸ˜Ÿ I feel anxious</button>
        <button type="button" onclick="quickMessage('I canâ€™t sleep')"
            style="padding:5px 10px; border-radius:6px; background:#fff3e6;">ðŸ˜´ I canâ€™t sleep</button>
        <button type="button" onclick="quickMessage('I need motivation')"
            style="padding:5px 10px; border-radius:6px; background:#e6ffe6;">ðŸ’ª I need motivation</button>
    </div>

    <!-- Input form fixed at bottom -->
    <form id="chat-form" method="post" style="display: flex; padding: 10px; border-top: 1px solid #ccc;">
        {% csrf_token %}
        <input type="text" id="query" name="query" placeholder="Type your message..." autocomplete="off"
            style="flex: 1; padding: 8px; border-radius: 5px; border: 1px solid #ccc;">
        <button type="submit" style="margin-left: 5px; padding: 8px 12px;">Send</button>
        <button type="button" onclick="startListening()" style="margin-left: 5px; padding: 8px 12px;">ðŸŽ¤</button>
    </form>
</div>

<script src="{% static 'chat/script.js' %}"></script>

<script>
    const chatBox = document.getElementById("chat-box");
    chatBox.scrollTop = chatBox.scrollHeight;  // always scroll to bottom

    // Quick button message filler + auto-submit
    function quickMessage(msg) {
        const input = document.getElementById("query");
        const form = document.getElementById("chat-form");
        input.value = msg;
        form.submit(); // auto-submit when button clicked
    }
</script>
{% endblock %}